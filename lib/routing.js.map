{"version":3,"sources":["../scripts/routing.js"],"names":[],"mappings":"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","file":"routing.js","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the pages/routing.\n */\nfriendlyPix.Router = class {\n\n  /**\n   * Initializes the Friendly Pix controller/router.\n   * @constructor\n   */\n  constructor() {\n    $(document).ready(() => {\n      friendlyPix.auth.waitForAuth.then(() => {\n        // Dom elements.\n        this.pagesElements = $('[id^=page-]');\n        this.splashLogin = $('#login', '#page-splash');\n\n        // Make sure /add is never opened on website load.\n        if (window.location.pathname === '/add') {\n          page('/');\n        }\n\n        // Configuring routes.\n        const pipe = friendlyPix.Router.pipe;\n        const displayPage = this.displayPage.bind(this);\n        const loadUser = userId => friendlyPix.userPage.loadUser(userId);\n        const showHomeFeed = () => friendlyPix.feed.showHomeFeed();\n        const showGeneralFeed = () => friendlyPix.feed.showGeneralFeed();\n        const clearFeed = () => friendlyPix.feed.clear();\n        const showPost = postId => friendlyPix.post.loadPost(postId);\n\n        page('/', pipe(showHomeFeed, null, true),\n            pipe(displayPage, {pageId: 'feed', onlyAuthed: true}));\n        page('/feed', pipe(showGeneralFeed, null, true), pipe(displayPage, {pageId: 'feed'}));\n        page('/post/:postId', pipe(showPost, null, true), pipe(displayPage, {pageId: 'post'}));\n        page('/user/:userId', pipe(loadUser, null, true), pipe(displayPage, {pageId: 'user-info'}));\n        page('/about', pipe(clearFeed, null, true), pipe(displayPage, {pageId: 'about'}));\n        page('/add', pipe(displayPage, {pageId: 'add', onlyAuthed: true}));\n        page('*', () => page('/'));\n\n        // Start routing.\n        page();\n      });\n    });\n  }\n\n  /**\n   * Returns a function that displays the given page and hides the other ones.\n   * if `onlyAuthed` is set to true then the splash page will be displayed instead of the page if\n   * the user is not signed-in.\n   */\n  displayPage(attributes, context) {\n    const onlyAuthed = attributes.onlyAuthed;\n    let pageId = attributes.pageId;\n\n    if (onlyAuthed && !firebase.app().auth().currentUser) {\n      pageId = 'splash';\n      this.splashLogin.show();\n    }\n    friendlyPix.Router.setLinkAsActive(context.canonicalPath);\n    this.pagesElements.each(function(index, element) {\n      if (element.id === 'page-' + pageId) {\n        $(element).show();\n      } else if (element.id === 'page-splash') {\n        $(element).fadeOut(1000);\n      } else {\n        $(element).hide();\n      }\n    });\n    friendlyPix.MaterialUtils.closeDrawer();\n    friendlyPix.Router.scrollToTop();\n  }\n\n  /**\n   * Reloads the current page.\n   */\n  reloadPage() {\n    let path = window.location.pathname;\n    if (path === '') {\n      path = '/';\n    }\n    page(path);\n  }\n\n  /**\n   * Scrolls the page to top.\n   */\n  static scrollToTop() {\n    $('html,body').animate({scrollTop: 0}, 0);\n  }\n\n  /**\n   * Pipes the given function and passes the given attribute and Page.js context.\n   * Set 'optContinue' to true if there are further functions to call.\n   */\n  static pipe(funct, attribute, optContinue) {\n    return (context, next) => {\n      if (funct) {\n        const params = Object.keys(context.params);\n        if (!attribute && params.length > 0) {\n          funct(context.params[params[0]], context);\n        } else {\n          funct(attribute, context);\n        }\n      }\n      if (optContinue) {\n        next();\n      }\n    };\n  }\n\n  /**\n   * Highlights the correct menu item/link.\n   */\n  static setLinkAsActive(canonicalPath) {\n    if (canonicalPath === '') {\n      canonicalPath = '/';\n    }\n    $('.is-active').removeClass('is-active');\n    $(`[href=\"${canonicalPath}\"]`).addClass('is-active');\n  }\n};\n\nfriendlyPix.router = new friendlyPix.Router();\n"]}