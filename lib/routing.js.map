{"version":3,"sources":["../scripts/routing.js"],"names":[],"mappings":"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","file":"routing.js","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the pages/routing.\n */\nfriendlyPix.Router = class {\n\n  /**\n   * Initializes the Friendly Pix controller/router.\n   * @constructor\n   */\n  constructor() {\n    $(document).ready(() => {\n      friendlyPix.auth.waitForAuth.then(() => {\n        // Dom elements.\n        this.pagesElements = $('[id^=page-]');\n        this.splashLogin = $('#login', '#page-splash');\n\n        // Make sure /add is never opened on website load.\n        if (window.location.pathname === '/add') {\n          page('/');\n        }\n\n        // Configuring routes.\n        const pipe = friendlyPix.Router.pipe;\n        const displayPage = this.displayPage.bind(this);\n        const loadUser = userId => friendlyPix.userPage.loadUser(userId);\n        const showHomeFeed = () => friendlyPix.feed.showHomeFeed();\n        const showGeneralFeed = () => friendlyPix.feed.showGeneralFeed();\n        const clearFeed = () => friendlyPix.feed.clear();\n        const showPost = postId => friendlyPix.post.loadPost(postId);\n\n        page('/', pipe(showHomeFeed, null, true),\n            pipe(displayPage, {pageId: 'feed', onlyAuthed: true}));\n        page('/feed', pipe(showGeneralFeed, null, true), pipe(displayPage, {pageId: 'feed'}));\n        page('/post/:postId', pipe(showPost, null, true), pipe(displayPage, {pageId: 'post'}));\n        page('/user/:userId', pipe(loadUser, null, true), pipe(displayPage, {pageId: 'user-info'}));\n        page('/about', pipe(clearFeed, null, true), pipe(displayPage, {pageId: 'about'}));\n        page('/add', pipe(displayPage, {pageId: 'add', onlyAuthed: true}));\n        page('*', () => page('/'));\n\n        // Start routing.\n        page();\n      });\n    });\n  }\n\n  /**\n   * Returns a function that displays the given page and hides the other ones.\n   * if `onlyAuthed` is set to true then the splash page will be displayed instead of the page if\n   * the user is not signed-in.\n   */\n  displayPage(attributes, context) {\n    const onlyAuthed = attributes.onlyAuthed;\n    let pageId = attributes.pageId;\n\n    if (onlyAuthed && !firebase.app().auth().currentUser) {\n      pageId = 'splash';\n      this.splashLogin.show();\n    }\n    friendlyPix.Router.setLinkAsActive(context.canonicalPath);\n    this.pagesElements.each(function(index, element) {\n      if (element.id === 'page-' + pageId) {\n        $(element).show();\n      } else if (element.id === 'page-splash') {\n        $(element).fadeOut(1000);\n      } else {\n        $(element).hide();\n      }\n    });\n    friendlyPix.MaterialUtils.closeDrawer();\n    friendlyPix.Router.scrollToTop();\n  }\n\n  /**\n   * Reloads the current page.\n   */\n  reloadPage() {\n    let path = window.location.pathname;\n    if (path === '') {\n      path = '/';\n    }\n    page(path);\n  }\n\n  /**\n   * Scrolls the page to top.\n   */\n  static scrollToTop() {\n    $('html,body').animate({scrollTop: 0}, 0);\n  }\n\n  /**\n   * Pipes the given function and passes the given attribute and Page.js context.\n   * Set 'optContinue' to true if there are further functions to call.\n   */\n  static pipe(funct, attribute, optContinue) {\n    return (context, next) => {\n      if (funct) {\n        const params = Object.keys(context.params);\n        if (!attribute && params.length > 0) {\n          funct(context.params[params[0]], context);\n        } else {\n          funct(attribute, context);\n        }\n      }\n      if (optContinue) {\n        next();\n      }\n    };\n  }\n\n  /**\n   * Highlights the correct menu item/link.\n   */\n  static setLinkAsActive(canonicalPath) {\n    if (canonicalPath === '') {\n      canonicalPath = '/';\n    }\n    $('.is-active').removeClass('is-active');\n    $(`[href=\"${canonicalPath}\"]`).addClass('is-active');\n  }\n};\n\nfriendlyPix.router = new friendlyPix.Router();\n"]}