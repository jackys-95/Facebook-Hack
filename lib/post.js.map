{"version":3,"sources":["../scripts/post.js"],"names":[],"mappings":"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","file":"post.js","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the single post UI.\n */\nfriendlyPix.Post = class {\n  /**\n   * Initializes the single post's UI.\n   * @constructor\n   */\n  constructor() {\n    // List of all times running on the page.\n    this.timers = [];\n\n    // Firebase SDK.\n    this.database = firebase.app().database();\n    this.storage = firebase.app().storage();\n    this.auth = firebase.app().auth();\n\n    $(document).ready(() => {\n      // Pointers to DOM elements.\n      this.postPage = $('#page-post');\n      this.postElement = $('.fp-post', this.postPage);\n      this.toast = $('.mdl-js-snackbar');\n      this.theatre = $('.fp-theatre');\n    });\n  }\n\n  /**\n   * Creates an unattached clone of the single post element.\n   * @return friendlyPix.Post\n   */\n  clone() {\n    const clone = new friendlyPix.Post();\n    clone.postElement = friendlyPix.MaterialUtils.cloneElementWithTextField(clone.postElement);\n    return clone;\n  }\n\n  /**\n   * Loads the given post's details.\n   */\n  loadPost(postId) {\n    // Load the posts information.\n    friendlyPix.firebase.getPostData(postId).then(snapshot => {\n      const post = snapshot.val();\n      // Clear listeners and previous post data.\n      this.clear();\n      if (!post) {\n        var data = {\n          message: 'This post does not exists.',\n          timeout: 5000\n        };\n        this.toast[0].MaterialSnackbar.showSnackbar(data);\n        if (this.auth.currentUser) {\n          page(`/user/${this.auth.currentUser.uid}`);\n        } else {\n          page(`/feed`);\n        }\n      } else {\n        this.fillPostData(snapshot.key, post.thumb_url || post.url, post.text, post.author,\n            post.timestamp, post.thumb_storage_uri, post.full_storage_uri, post.full_url);\n      }\n    });\n  }\n\n  /**\n   * Clears all listeners and times in the given element.\n   */\n  clear() {\n    // Stops all timers if any.\n    this.timers.forEach(timer => clearInterval(timer));\n    this.timers = [];\n\n    const newElement = friendlyPix.MaterialUtils.cloneElementWithTextField(this.postElement);\n    if (this.postElement.parent()) {\n      this.postElement.parent().append(newElement);\n      this.postElement.detach();\n    }\n    this.postElement = newElement;\n\n    // Remove Firebase listeners.\n    friendlyPix.firebase.cancelAllSubscriptions();\n  }\n\n  /**\n   * Displays the given list of `comments` in the post.\n   */\n  displayComments(comments) {\n    const commentsIds = Object.keys(comments);\n    for (let i = commentsIds.length - 1; i >= 0; i--) {\n      $('.fp-comments', this.postElement).prepend(\n          friendlyPix.Post.createCommentHtml(comments[commentsIds[i]].author,\n              comments[commentsIds[i]].text));\n    }\n  }\n\n  /**\n   * Shows the \"show more comments\" button and binds it the `nextPage` callback. If `nextPage` is\n   * `null` then the button is hidden.\n   */\n  displayNextPageButton(nextPage) {\n    const nextPageButton = $('.fp-morecomments', this.postElement);\n    if (nextPage) {\n      nextPageButton.show();\n      nextPageButton.unbind('click');\n      nextPageButton.prop('disabled', false);\n      nextPageButton.click(() => nextPage().then(data => {\n        nextPageButton.prop('disabled', true);\n        this.displayComments(data.entries);\n        this.displayNextPageButton(data.nextPage);\n      }));\n    } else {\n      nextPageButton.hide();\n    }\n  }\n\n  /**\n   * Fills the post's Card with the given details.\n   * Also sets all auto updates and listeners on the UI elements of the post.\n   */\n  fillPostData(postId, thumbUrl, imageText, author, timestamp, thumbStorageUri, picStorageUri, picUrl) {\n    const post = this.postElement;\n\n    // Fills element's author profile.\n    $('.fp-usernamelink', post).attr('href', `/user/${author.uid}`);\n    $('.fp-avatar', post).css('background-image',\n        `url(${author.profile_picture || '/images/silhouette.jpg'})`);\n    $('.fp-username', post).text(author.full_name || 'Anonymous');\n\n    // Shows the pic's thumbnail.\n    $('.fp-image', post).css('background-image', `url(${thumbUrl})`);\n    $('.fp-image', post).unbind('click');\n    $('.fp-image', post).click(() => this.enterTheatreMode(picUrl, thumbUrl));\n\n    this._setupDate(postId, timestamp);\n    this._setupDeleteButton(postId, author, picStorageUri, thumbStorageUri);\n    this._setupLikeCountAndStatus(postId);\n    this._setupComments(postId, author, imageText);\n    return post;\n  }\n\n  /**\n   * Leaves the theatre mode.\n   */\n  leaveTheatreMode() {\n    this.theatre.hide();\n    this.theatre.unbind('click');\n    $(document).unbind('keydown');\n  }\n\n  /**\n   * Leaves the theatre mode.\n   */\n  enterTheatreMode(picUrl, thumbUrl) {\n    $('.fp-fullpic', this.theatre).prop('src', picUrl || thumbUrl);\n    this.theatre.css('display', 'flex');\n    // Leave theatre mode if click or ESC key down.\n    this.theatre.click(() => this.leaveTheatreMode());\n    $(document).keydown(e => {\n      if (e.which === 27) {\n        this.leaveTheatreMode();\n      }\n    });\n  }\n\n  /**\n   * Shows the publishing date of the post and updates this date live.\n   * @private\n   */\n  _setupDate(postId, timestamp) {\n    const post = this.postElement;\n\n    $('.fp-time', post).attr('href', `/post/${postId}`);\n    $('.fp-time', post).text(friendlyPix.Post.getTimeText(timestamp));\n    // Update the time counter every minutes.\n    this.timers.push(setInterval(\n      () => $('.fp-time', post).text(friendlyPix.Post.getTimeText(timestamp)), 60000));\n  }\n\n  /**\n   * Shows comments and binds actions to the comments form.\n   * @private\n   */\n  _setupComments(postId, author, imageText) {\n    const post = this.postElement;\n\n    // Creates the initial comment with the post's text.\n    $('.fp-first-comment', post).empty();\n    $('.fp-first-comment', post).append(friendlyPix.Post.createCommentHtml(author, imageText));\n\n    // Load first page of comments and listen to new comments.\n    $('.fp-comments', post).empty();\n    friendlyPix.firebase.getComments(postId).then(data => {\n      this.displayComments(data.entries);\n      this.displayNextPageButton(data.nextPage);\n\n      // Display any new comments.\n      const commentIds = Object.keys(data.entries);\n      friendlyPix.firebase.subscribeToComments(postId, (commentId, commentData) => {\n        $('.fp-comments', post).append(\n          friendlyPix.Post.createCommentHtml(commentData.author, commentData.text));\n      }, commentIds ? commentIds[commentIds.length - 1] : 0);\n    });\n\n    if (this.auth.currentUser) {\n      // Bind comments form posting.\n      $('.fp-add-comment', post).submit(e => {\n        e.preventDefault();\n        const commentText = $(`.mdl-textfield__input`, post).val();\n        friendlyPix.firebase.addComment(postId, commentText);\n        $(`.mdl-textfield__input`, post).val('');\n      });\n      const ran = Math.floor(Math.random() * 10000000);\n      $('.mdl-textfield__input', post).attr('id', `${postId}-${ran}-comment`);\n      $('.mdl-textfield__label', post).attr('for', `${postId}-${ran}-comment`);\n      // Show comments form.\n      $('.fp-action', post).css('display', 'flex');\n    }\n  }\n\n  /**\n   * Shows/Hode and binds actions to the Delete button.\n   * @private\n   */\n  _setupDeleteButton(postId, author, picStorageUri, thumbStorageUri) {\n    const post = this.postElement;\n\n    if (this.auth.currentUser && this.auth.currentUser.uid === author.uid && picStorageUri) {\n      $('.fp-delete-post', post).show();\n      $('.fp-delete-post', post).click(() => {\n        swal({\n          title: 'Are you sure?',\n          text: 'You will not be able to recover this post!',\n          type: 'warning',\n          showCancelButton: true,\n          confirmButtonColor: '#DD6B55',\n          confirmButtonText: 'Yes, delete it!',\n          closeOnConfirm: false,\n          showLoaderOnConfirm: true,\n          allowEscapeKey: true\n        }, () => {\n          $('.fp-delete-post', post).prop('disabled', true);\n          friendlyPix.firebase.deletePost(postId, picStorageUri, thumbStorageUri).then(() => {\n            swal({\n              title: 'Deleted!',\n              text: 'Your post has been deleted.',\n              type: 'success',\n              timer: 2000\n            });\n            $('.fp-delete-post', post).prop('disabled', false);\n            page(`/user/${this.auth.currentUser.uid}`);\n          }).catch(error => {\n            swal.close();\n            $('.fp-delete-post', post).prop('disabled', false);\n            const data = {\n              message: `There was an error deleting your post: ${error}`,\n              timeout: 5000\n            };\n            this.toast[0].MaterialSnackbar.showSnackbar(data);\n          });\n        });\n      });\n    } else {\n      $('.fp-delete-post', post).hide();\n    }\n  }\n\n  /**\n   * Starts Likes count listener and on/off like status.\n   * @private\n   */\n  _setupLikeCountAndStatus(postId) {\n    const post = this.postElement;\n\n    if (this.auth.currentUser) {\n      // Listen to like status.\n      friendlyPix.firebase.registerToUserLike(postId, isliked => {\n        if (isliked) {\n          $('.fp-liked', post).show();\n          $('.fp-not-liked', post).hide();\n        } else {\n          $('.fp-liked', post).hide();\n          $('.fp-not-liked', post).show();\n        }\n      });\n\n      // Add event listeners.\n      $('.fp-liked', post).click(() => friendlyPix.firebase.updateLike(postId, false));\n      $('.fp-not-liked', post).click(() => friendlyPix.firebase.updateLike(postId, true));\n    } else {\n      $('.fp-liked', post).hide();\n      $('.fp-not-liked', post).hide();\n      $('.fp-action', post).hide();\n    }\n\n    // Listen to number of Likes.\n    friendlyPix.firebase.registerForLikesCount(postId, nbLikes => {\n      if (nbLikes > 0) {\n        $('.fp-likes', post).show();\n        $('.fp-likes', post).text(nbLikes + ' like' + (nbLikes === 1 ? '' : 's'));\n      } else {\n        $('.fp-likes', post).hide();\n      }\n    });\n  }\n\n  /**\n   * Returns the HTML for a post's comment.\n   */\n  static createCommentHtml(author, text) {\n    return `\n        <div class=\"fp-comment\">\n            <a class=\"fp-author\" href=\"/user/${author.uid}\">${author.full_name || 'Anonymous'}</a>:\n            <span class=\"fp-text\">${text}</span>\n        </div>`;\n  }\n\n  /**\n   * Given the time of creation of a post returns how long since the creation of the post in text\n   * format. e.g. 5d, 10h, now...\n   */\n  static getTimeText(postCreationTimestamp) {\n    let millis = Date.now() - postCreationTimestamp;\n    const ms = millis % 1000;\n    millis = (millis - ms) / 1000;\n    const secs = millis % 60;\n    millis = (millis - secs) / 60;\n    const mins = millis % 60;\n    millis = (millis - mins) / 60;\n    const hrs = millis % 24;\n    const days = (millis - hrs) / 24;\n    var timeSinceCreation = [days, hrs, mins, secs, ms];\n\n    let timeText = 'Now';\n    if (timeSinceCreation[0] !== 0) {\n      timeText = timeSinceCreation[0] + 'd';\n    } else if (timeSinceCreation[1] !== 0) {\n      timeText = timeSinceCreation[1] + 'h';\n    } else if (timeSinceCreation[2] !== 0) {\n      timeText = timeSinceCreation[2] + 'm';\n    }\n    return timeText;\n  }\n};\n\nfriendlyPix.post = new friendlyPix.Post();\n"]}