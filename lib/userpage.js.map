{"version":3,"sources":["../scripts/userpage.js"],"names":[],"mappings":"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","file":"userpage.js","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the User Profile UI.\n */\nfriendlyPix.UserPage = class {\n\n  /**\n   * Initializes the user's profile UI.\n   * @constructor\n   */\n  constructor() {\n    // Firebase SDK.\n    this.database = firebase.app().database();\n    this.auth = firebase.app().auth();\n\n    $(document).ready(() => {\n      // DOM Elements.\n      this.userPage = $('#page-user-info');\n      this.userAvatar = $('.fp-user-avatar');\n      this.toast = $('.mdl-js-snackbar');\n      this.userUsername = $('.fp-user-username');\n      this.userInfoContainer = $('.fp-user-container');\n      this.followContainer = $('.fp-follow');\n      this.noPosts = $('.fp-no-posts', this.userPage);\n      this.followLabel = $('.mdl-switch__label', this.followContainer);\n      this.followCheckbox = $('#follow');\n      this.nbPostsContainer = $('.fp-user-nbposts', this.userPage);\n      this.nbFollowers = $('.fp-user-nbfollowers', this.userPage);\n      this.nbFollowing = $('.fp-user-nbfollowing', this.userPage);\n      this.nbFollowingContainer = $('.fp-user-nbfollowing-container', this.userPage);\n      this.followingContainer = $('.fp-user-following', this.userPage);\n      this.nextPageButton = $('.fp-next-page-button button');\n      this.closeFollowingButton = $('.fp-close-following', this.userPage);\n      this.userInfoPageImageContainer = $('.fp-image-container', this.userPage);\n\n      // Event bindings.\n      this.followCheckbox.change(() => this.onFollowChange());\n      this.auth.onAuthStateChanged(() => this.trackFollowStatus());\n      this.nbFollowingContainer.click(() => this.displayFollowing());\n      this.closeFollowingButton.click(() => {\n        this.followingContainer.hide();\n        this.nbFollowingContainer.removeClass('is-active');\n      });\n    });\n  }\n\n  /**\n   * Triggered when the user changes the \"Follow\" checkbox.\n   */\n  onFollowChange() {\n    const checked = this.followCheckbox.prop('checked');\n    this.followCheckbox.prop('disabled', true);\n\n    return friendlyPix.firebase.toggleFollowUser(this.userId, checked);\n  }\n\n  /**\n   * Starts tracking the \"Follow\" checkbox status.\n   */\n  trackFollowStatus() {\n    if (this.auth.currentUser) {\n      friendlyPix.firebase.registerToFollowStatusUpdate(this.userId, data => {\n        this.followCheckbox.prop('checked', data.val() !== null);\n        this.followCheckbox.prop('disabled', false);\n        this.followLabel.text(data.val() ? 'Following' : 'Follow');\n        friendlyPix.MaterialUtils.refreshSwitchState(this.followContainer);\n      });\n    }\n  }\n\n  /**\n   * Adds the list of posts to the UI.\n   */\n  addPosts(posts) {\n    const postIds = Object.keys(posts);\n    for (let i = postIds.length - 1; i >= 0; i--) {\n      this.userInfoPageImageContainer.append(\n          friendlyPix.UserPage.createImageCard(postIds[i],\n              posts[postIds[i]].thumb_url || posts[postIds[i]].url, posts[postIds[i]].text));\n      this.noPosts.hide();\n    }\n  }\n\n  /**\n   * Shows the \"load next page\" button and binds it the `nextPage` callback. If `nextPage` is `null`\n   * then the button is hidden.\n   */\n  toggleNextPageButton(nextPage) {\n    if (nextPage) {\n      this.nextPageButton.show();\n      this.nextPageButton.unbind('click');\n      this.nextPageButton.prop('disabled', false);\n      this.nextPageButton.click(() => {\n        this.nextPageButton.prop('disabled', true);\n        nextPage().then(data => {\n          this.addPosts(data.entries);\n          this.toggleNextPageButton(data.nextPage);\n        });\n      });\n    } else {\n      this.nextPageButton.hide();\n    }\n  }\n\n  /**\n   * Displays the given user information in the UI.\n   */\n  loadUser(userId) {\n    this.userId = userId;\n\n    // Reset the UI.\n    this.clear();\n\n    // If users is the currently signed-in user we hide the \"Follow\" Checkbox.\n    if (this.auth.currentUser && userId === this.auth.currentUser.uid) {\n      this.followContainer.hide();\n    } else {\n      this.followContainer.show();\n      this.followCheckbox.prop('disabled', true);\n      friendlyPix.MaterialUtils.refreshSwitchState(this.followContainer);\n      // Start live tracking the state of the \"Follow\" Checkbox.\n      this.trackFollowStatus();\n    }\n\n    // Load user's profile.\n    friendlyPix.firebase.loadUserProfile(userId).then(snapshot => {\n      const userInfo = snapshot.val();\n      if (userInfo) {\n        this.userAvatar.css('background-image',\n            `url(\"${userInfo.profile_picture || '/images/silhouette.jpg'}\")`);\n        this.userUsername.text(userInfo.full_name || 'Anonymous');\n        this.userInfoContainer.show();\n      } else {\n        var data = {\n          message: 'This user does not exists.',\n          timeout: 5000\n        };\n        this.toast[0].MaterialSnackbar.showSnackbar(data);\n        page(`/feed`);\n      }\n    });\n\n    // Lod user's number of followers.\n    friendlyPix.firebase.registerForFollowersCount(userId,\n        nbFollowers => this.nbFollowers.text(nbFollowers));\n\n    // Lod user's number of followed users.\n    friendlyPix.firebase.registerForFollowingCount(userId,\n        nbFollowed => this.nbFollowing.text(nbFollowed));\n\n    // Lod user's number of posts.\n    friendlyPix.firebase.registerForPostsCount(userId,\n        nbPosts => this.nbPostsContainer.text(nbPosts));\n\n    // Display user's posts.\n    friendlyPix.firebase.getUserFeedPosts(userId).then(data => {\n      const postIds = Object.keys(data.entries);\n      if (postIds.length === 0) {\n        this.noPosts.show();\n      }\n      friendlyPix.firebase.subscribeToUserFeed(userId,\n        (postId, postValue) => {\n          this.userInfoPageImageContainer.prepend(\n              friendlyPix.UserPage.createImageCard(postId,\n                  postValue.thumb_url || postValue.url, postValue.text));\n          this.noPosts.hide();\n        }, postIds[postIds.length - 1]);\n\n      // Adds fetched posts and next page button if necessary.\n      this.addPosts(data.entries);\n      this.toggleNextPageButton(data.nextPage);\n    });\n\n    // Listen for posts deletions.\n    friendlyPix.firebase.registerForPostsDeletion(postId =>\n        $(`.fp-post-${postId}`, this.userPage).remove());\n  }\n\n  /**\n   * Displays the list of followed people.\n   */\n  displayFollowing() {\n    friendlyPix.firebase.getFollowingProfiles(this.userId).then(profiles => {\n      // Clear previous following list.\n      $('.fp-usernamelink', this.followingContainer).remove();\n      // Display all following profile cards.\n      Object.keys(profiles).forEach(uid => this.followingContainer.prepend(\n          friendlyPix.UserPage.createProfileCardHtml(\n              uid, profiles[uid].profile_picture, profiles[uid].full_name)));\n      if (Object.keys(profiles).length > 0) {\n        this.followingContainer.show();\n        // Mark submenu as active.\n        this.nbFollowingContainer.addClass('is-active');\n      }\n    });\n  }\n\n  /**\n   * Clears the UI and listeners.\n   */\n  clear() {\n    // Removes all pics.\n    $('.fp-image', this.userInfoPageImageContainer).remove();\n\n    // Remove active states of sub menu selectors (like \"Following\").\n    $('.is-active', this.userInfoPageImageContainer).removeClass('is-active');\n\n    // Cancel all Firebase listeners.\n    friendlyPix.firebase.cancelAllSubscriptions();\n\n    // Hides the \"Load Next Page\" button.\n    this.nextPageButton.hide();\n\n    // Hides the user info box.\n    this.userInfoContainer.hide();\n\n    // Hide and empty the list of Followed people.\n    this.followingContainer.hide();\n    $('.fp-usernamelink', this.followingContainer).remove();\n\n    // Stops then infinite scrolling listeners.\n    friendlyPix.MaterialUtils.stopOnEndScrolls();\n\n    // Hide the \"No posts\" message.\n    this.noPosts.hide();\n  }\n\n  /**\n   * Returns an image Card element for the image with the given URL.\n   */\n  static createImageCard(postId, imageUrl, text) {\n    const element = $(`\n          <a href=\"/post/${postId}\" class=\"fp-post-${postId} fp-image mdl-cell mdl-cell--12-col mdl-cell--4-col-tablet\n                                            mdl-cell--4-col-desktop mdl-grid mdl-grid--no-spacing\">\n              <div class=\"fp-overlay\">\n                  <i class=\"material-icons\">favorite</i><span class=\"likes\">0</span>\n                  <i class=\"material-icons\">mode_comment</i><span class=\"comments\">0</span>\n                  <div class=\"fp-pic-text\">${text}</div>\n              </div>\n              <div class=\"mdl-card mdl-shadow--2dp mdl-cell\n                          mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop\"\n                   style=\"background-image: url(${imageUrl})\"></div>\n          </a>`);\n\n    // Start listening for comments and likes counts.\n    friendlyPix.firebase.registerForLikesCount(postId,\n        nbLikes => $('.likes', element).text(nbLikes));\n    friendlyPix.firebase.registerForCommentsCount(postId,\n        nbComments => $('.comments', element).text(nbComments));\n\n    return element;\n  }\n\n  /**\n   * Returns an image Card element for the image with the given URL.\n   */\n  static createProfileCardHtml(uid, profilePic = '/images/silhouette.jpg', fullName = 'Anonymous') {\n    return `\n        <a class=\"fp-usernamelink mdl-button mdl-js-button\" href=\"/user/${uid}\">\n            <div class=\"fp-avatar\" style=\"background-image: url('${profilePic}')\"></div>\n            <div class=\"fp-username mdl-color-text--black\">${fullName}</div>\n        </a>`;\n  }\n};\n\nfriendlyPix.userPage = new friendlyPix.UserPage();\n"]}