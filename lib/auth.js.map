{"version":3,"sources":["../scripts/auth.js"],"names":[],"mappings":";;;;;;;;;;;;;;;AAeA;;AAEA,OAAO,WAAP,GAAqB,OAAO,WAAP,IAAsB,EAA3C;;;;;AAKA,YAAY,IAAZ,GAAmB,MAAM;;;;;;AAMvB,MAAI,WAAJ,GAAkB;AAChB,WAAO,KAAK,2BAAL,CAAiC,OAAjC,EAAP,CACD;;;;;;;;AAOD,gBAAc;;AAEZ,SAAK,QAAL,GAAgB,SAAS,GAAT,GAAe,QAAf,EAAhB;AACA,SAAK,IAAL,GAAY,SAAS,GAAT,GAAe,IAAf,EAAZ;AACA,SAAK,2BAAL,GAAmC,IAAI,EAAE,QAAN,EAAnC;;AAEA,MAAE,QAAF,EAAY,KAAZ,CAAkB,MAAM;;AAEtB,WAAK,YAAL,GAAoB,EAAE,oBAAF,CAApB;AACA,YAAM,wBAAwB,EAAE,8BAAF,CAA9B;AACA,WAAK,kBAAL,GAA0B,EAAE,YAAF,EAAgB,qBAAhB,CAA1B;AACA,WAAK,gBAAL,GAAwB,EAAE,cAAF,EAAkB,qBAAlB,CAAxB;AACA,WAAK,aAAL,GAAqB,EAAE,cAAF,CAArB;AACA,WAAK,qBAAL,GAA6B,EAAE,qBAAF,CAA7B;AACA,WAAK,oBAAL,GAA4B,EAAE,oBAAF,CAA5B;AACA,WAAK,YAAL,GAAoB,EAAE,kBAAF,CAApB;;;AAGA,WAAK,YAAL,CAAkB,KAAlB;AACI,YAAM,KAAK,IAAL,CAAU,eAAV,CAA0B,IAAI,SAAS,IAAT,CAAc,kBAAlB,EAA1B,CADV;AAEA,WAAK,aAAL,CAAmB,KAAnB,CAAyB,MAAM,KAAK,IAAL,CAAU,OAAV,EAA/B;AACA,WAAK,oBAAL,CAA0B,IAA1B,GACD,CAhBD;;;AAkBA,SAAK,IAAL,CAAU,kBAAV,CAA6B,QAAQ,KAAK,kBAAL,CAAwB,IAAxB,CAArC,EACD;;;;;;;AAMD,qBAAmB,IAAnB,EAAyB;AACvB,QAAI,OAAO,WAAP,CAAmB,MAAvB,EAA+B;AAC7B,aAAO,WAAP,CAAmB,MAAnB,CAA0B,UAA1B,GACD;;AACD,SAAK,2BAAL,CAAiC,OAAjC;AACA,MAAE,QAAF,EAAY,KAAZ,CAAkB,MAAM;AACtB,UAAI,CAAC,IAAL,EAAW;AACT,aAAK,qBAAL,CAA2B,IAA3B;AACA,aAAK,oBAAL,CAA0B,IAA1B;AACA,aAAK,MAAL,GAAc,SAAd;AACA,aAAK,kBAAL,CAAwB,GAAxB,CAA4B,kBAA5B,EAAgD,EAAhD,EACD,CALD;AAKO;AACL,aAAK,qBAAL,CAA2B,IAA3B;AACA,aAAK,oBAAL,CAA0B,IAA1B;AACA,aAAK,MAAL,GAAc,KAAK,GAAnB;AACA,aAAK,kBAAL,CAAwB,GAAxB,CAA4B,kBAA5B;AACK,iBAAO,KAAK,QAAL,IAAiB,wBAAyB,KADtD;AAEA,aAAK,gBAAL,CAAsB,IAAtB,CAA2B,KAAK,WAAhC;AACA,aAAK,YAAL,CAAkB,IAAlB,CAAuB,MAAvB,EAAgC,UAAQ,KAAK,GAAI,GAAjD;AACA,oBAAY,QAAZ,CAAqB,YAArB,CAAkC,KAAK,QAAvC,EAAiD,KAAK,WAAtD,EACD,CACF,CAhBD,EAiBD,CApEsB,CAAzB;;;;;;AAuEA,YAAY,IAAZ,GAAmB,IAAI,YAAY,IAAhB,EAAnB","file":"auth.js","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the user auth flows and updating the UI depending on the auth state.\n */\nfriendlyPix.Auth = class {\n\n  /**\n   * Returns a Promise that completes when auth is ready.\n   * @return Promise\n   */\n  get waitForAuth() {\n    return this._waitForAuthPromiseResolver.promise();\n  }\n\n  /**\n   * Initializes Friendly Pix's auth.\n   * Binds the auth related UI components and handles the auth flow.\n   * @constructor\n   */\n  constructor() {\n    // Firebase SDK\n    this.database = firebase.app().database();\n    this.auth = firebase.app().auth();\n    this._waitForAuthPromiseResolver = new $.Deferred();\n\n    $(document).ready(() => {\n      // Pointers to DOM Elements\n      this.signInButton = $('.fp-sign-in-button');\n      const signedInUserContainer = $('.fp-signed-in-user-container');\n      this.signedInUserAvatar = $('.fp-avatar', signedInUserContainer);\n      this.signedInUsername = $('.fp-username', signedInUserContainer);\n      this.signOutButton = $('.fp-sign-out');\n      this.signedOutOnlyElements = $('.fp-signed-out-only');\n      this.signedInOnlyElements = $('.fp-signed-in-only');\n      this.usernameLink = $('.fp-usernamelink');\n\n      // Event bindings\n      this.signInButton.click(\n          () => this.auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()));\n      this.signOutButton.click(() => this.auth.signOut());\n      this.signedInOnlyElements.hide();\n    });\n\n    this.auth.onAuthStateChanged(user => this.onAuthStateChanged(user));\n  }\n\n  /**\n   * Displays the signed-in user information in the UI or hides it and displays the\n   * \"Sign-In\" button if the user isn't signed-in.\n   */\n  onAuthStateChanged(user) {\n    if (window.friendlyPix.router) {\n      window.friendlyPix.router.reloadPage();\n    }\n    this._waitForAuthPromiseResolver.resolve();\n    $(document).ready(() => {\n      if (!user) {\n        this.signedOutOnlyElements.show();\n        this.signedInOnlyElements.hide();\n        this.userId = undefined;\n        this.signedInUserAvatar.css('background-image', '');\n      } else {\n        this.signedOutOnlyElements.hide();\n        this.signedInOnlyElements.show();\n        this.userId = user.uid;\n        this.signedInUserAvatar.css('background-image',\n            `url(\"${user.photoURL || '/images/silhouette.jpg'}\")`);\n        this.signedInUsername.text(user.displayName);\n        this.usernameLink.attr('href', `/user/${user.uid}`);\n        friendlyPix.firebase.saveUserData(user.photoURL, user.displayName);\n      }\n    });\n  }\n};\n\nfriendlyPix.auth = new friendlyPix.Auth();\n"]}